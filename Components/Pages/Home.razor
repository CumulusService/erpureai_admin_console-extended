@page "/"
@using AdminConsole.Models
@inject NavigationManager Navigation
@inject ILogger<Home> Logger
@rendermode InteractiveServer

<PageTitle>ERPURE.AI Admin Console</PageTitle>

<AuthorizeView>
    <Authorized>
        <div class="container-fluid" style="min-height: 100vh; background: linear-gradient(135deg, #f8f9ff 0%, #e9ecff 100%);">
            <div class="row justify-content-center align-items-center" style="min-height: 100vh;">
                <div class="col-md-10 col-lg-8 col-xl-6">
                    <div class="card shadow-lg border-0" style="border-radius: 20px; backdrop-filter: blur(10px);">
                        <div class="card-body text-center p-5">
                            <div class="mb-5">
                                <div class="d-flex justify-content-center mb-4">
                                    <img src="company-logo.png" alt="ERPURE.AI Logo" class="img-fluid" style="max-height: 60px; max-width: 250px;" />
                                </div>
                                <h1 class="fw-bold text-dark mb-3">Admin Console</h1>
                                <p class="text-muted fs-5 mb-2">Welcome back, <strong>@context.User.Identity?.Name</strong></p>
                                <p class="text-muted">Choose your dashboard to get started</p>
                            </div>
                            
                            <div class="row g-4">
                                <!-- Super Admin Dashboard -->
                                <AuthorizeView Policy="SuperAdminOnly">
                                    <Authorized Context="superAdminContext">
                                        <div class="col-12 col-md-6">
                                            <div class="dashboard-card" @onclick="() => RedirectToRole(UserRole.SuperAdmin)">
                                                <div class="card h-100 border-0 shadow-sm position-relative overflow-hidden" style="border-radius: 16px; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);">
                                                    <div class="card-body d-flex flex-column justify-content-center text-white p-4" style="min-height: 140px;">
                                                        <div class="mb-3">
                                                            <i class="fas fa-crown fa-3x opacity-75"></i>
                                                        </div>
                                                        <h4 class="fw-bold mb-2">Super Admin</h4>
                                                        <p class="mb-0 opacity-90">Manage Organizations & Admins</p>
                                                    </div>
                                                    <div class="position-absolute top-0 end-0 p-3">
                                                        <i class="fas fa-arrow-right text-white opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </Authorized>
                                </AuthorizeView>

                                <!-- Developer Dashboard -->
                                <AuthorizeView Policy="DevOnly">
                                    <Authorized Context="devContext">
                                        <div class="col-12 col-md-6">
                                            <div class="dashboard-card" @onclick="() => RedirectToRole(UserRole.Developer)">
                                                <div class="card h-100 border-0 shadow-sm position-relative overflow-hidden" style="border-radius: 16px; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                                    <div class="card-body d-flex flex-column justify-content-center text-white p-4" style="min-height: 140px;">
                                                        <div class="mb-3">
                                                            <i class="fas fa-code fa-3x opacity-75"></i>
                                                        </div>
                                                        <h4 class="fw-bold mb-2">Developer</h4>
                                                        <p class="mb-0 opacity-90">Manage Agent Types & System Config</p>
                                                    </div>
                                                    <div class="position-absolute top-0 end-0 p-3">
                                                        <i class="fas fa-arrow-right text-white opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </Authorized>
                                </AuthorizeView>

                                <!-- Organization Admin Dashboard -->
                                <AuthorizeView Policy="OrgAdminOnly">
                                    <Authorized Context="orgAdminContext">
                                        <div class="col-12 col-md-6">
                                            <div class="dashboard-card" @onclick="() => RedirectToRole(UserRole.OrgAdmin)">
                                                <div class="card h-100 border-0 shadow-sm position-relative overflow-hidden" style="border-radius: 16px; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #4ecdc4 0%, #2eb8ae 100%);">
                                                    <div class="card-body d-flex flex-column justify-content-center text-white p-4" style="min-height: 140px;">
                                                        <div class="mb-3">
                                                            <i class="fas fa-user-shield fa-3x opacity-75"></i>
                                                        </div>
                                                        <h4 class="fw-bold mb-2">Organization Admin</h4>
                                                        <p class="mb-0 opacity-90">Manage Users & Secrets</p>
                                                    </div>
                                                    <div class="position-absolute top-0 end-0 p-3">
                                                        <i class="fas fa-arrow-right text-white opacity-50"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </Authorized>
                                </AuthorizeView>
                            </div>
                            
                            <div class="mt-5 pt-4">
                                <small class="text-muted">
                                    <i class="fas fa-shield-alt me-1"></i>
                                    Secure multi-tenant admin platform
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            .dashboard-card:hover .card {
                transform: translateY(-4px);
                box-shadow: 0 12px 35px rgba(0,0,0,0.15) !important;
            }
            
            .dashboard-card:hover .fa-arrow-right {
                transform: translateX(4px);
                transition: transform 0.3s ease;
            }
        </style>
    </Authorized>
    <NotAuthorized>
        <div class="container-fluid d-flex justify-content-center align-items-center" style="min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="card shadow-lg border-0" style="max-width: 420px; width: 100%; border-radius: 20px; backdrop-filter: blur(10px);">
                <div class="card-body text-center p-5">
                    <div class="mb-5">
                        <div class="d-flex justify-content-center mb-4">
                            <img src="company-logo.png" alt="ERPURE.AI Logo" class="img-fluid" style="max-height: 50px; max-width: 200px;" />
                        </div>
                        <h2 class="fw-bold text-dark mb-2">Admin Console</h2>
                        <p class="text-muted fs-6">Enterprise B2B Partner Platform</p>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="fw-normal mb-3 text-dark">Welcome Back</h4>
                        <p class="text-muted mb-4">Sign in to access your admin dashboard</p>
                    </div>
                    
                    <button class="btn btn-primary btn-lg w-100 py-3 fw-semibold" @onclick="SignIn" style="border-radius: 12px; background: linear-gradient(45deg, #667eea, #764ba2); border: none; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                        <i class="fas fa-sign-in-alt me-2"></i>
                        Sign In
                    </button>
                    
                    <div class="mt-4 pt-3">
                        <small class="text-muted">
                            <i class="fas fa-lock me-1"></i>
                            Secure authentication powered by Microsoft
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    private void SignIn()
    {
        Logger.LogInformation("SignIn button clicked - navigating to challenge");
        try 
        {
            Navigation.NavigateTo("/Account/Challenge", forceLoad: true);
            Logger.LogInformation("Navigation.NavigateTo called successfully");
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error during navigation");
        }
    }

    private void RedirectToRole(UserRole role)
    {
        string redirectUrl = role switch
        {
            UserRole.SuperAdmin => "/owner/dashboard",
            UserRole.Developer => "/developer/dashboard",
            UserRole.OrgAdmin => "/admin/users",
            _ => "/admin/users"
        };
        
        Navigation.NavigateTo(redirectUrl);
    }
}
